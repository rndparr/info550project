# About
The repository contains scripts and data for generating a report about the results (including Manhattan plots, QQ plots, and tables of significant genes) of two Transcriptome-Wide Association Studies (TWAS); one on ovarian cancer, and one on breast cancer. The raw data file is found in the `raw_data` directory. Cleaned data and data used to generate plots and tables is located in `clean_data`. Figures generated by the code are saved in `figs`. R and Rmd scripts used in report generation are in `R`. The `biblio` folder contains files for generating a bibliography.


# Generate Report (without Docker)
## R packages
To analyze the data, the `R` packages "ggplot2", "knitr", "kableExtra" need to be installed. To do so, run the following:
``` bash
make install
```

<!-- To analyze the data you will need to install some `R` packages. The required packages can be installed using `R` commands.

``` r
installed_pkgs <- row.names(installed.packages())
pkgs <- c("ggplot2", "knitr", "kableExtra")
for(p in pkgs){
	if(!(p %in% install_pkgs)){
		install.packages(p)
	}
}
``` -->

## pandoc-citeproc (optional; required for bibliography)
Report generation with citations and bibliography requires installing pandoc-citeproc.

### Ubuntu
``` bash
sudo apt-get update -y
sudo apt-get install -y pandoc-citeproc
```

### macOS
``` bash
brew install pandoc-citeproc 
```

## Execute the analysis
To execute the analysis, from the project folder you can run: 
``` bash
make report
```
The command will create a file called `report.html` in `./output/` which contains the results. By default this output report will not contain a bibliography if the environment variable `biblio` is not defined or if it is equal to `n`.

A report with the bibliography can be generated (if `pandoc-citeproc` is installed) using:
``` bash
make report biblio=y
```

## Help
``` bash
make help
```

## Clean
Remove all files created in report generation using:
``` bash
make clean
```

# Generate Report with Docker
1. [Install](https://docs.docker.com/get-docker/) Docker.
1. Start up Docker using:
``` bash
open -a Docker
```
1. Download the [Docker image](https://hub.docker.com/r/rndparr/twasproject) using:
``` bash
docker pull rndparr/twasproject
```
1. Mount the desired output directory (`/the/full/output/path` in example) and run:
``` bash
docker run -v /the/full/output/path:/project/output -it rndparr/twasproject
```
The file `report.html` will be generated. By default the bibliography will be generated when using the Docker image. To generate a report without the bibliography:
``` bash
docker run -e biblio=n -v /the/full/output/path:/project/output -it rndparr/twasproject
```

